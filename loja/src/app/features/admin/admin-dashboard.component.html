<section class="page-title">
  <div>
    <p class="eyebrow">Painel</p>
    <h1>Pedidos da loja</h1>
    <p class="muted">Veja o que entrou, filtre por status, cliente ou itens comprados.</p>
  </div>
</section>

<section class="filters">
  <mat-form-field appearance="outline" class="filter-field">
    <mat-label>Status</mat-label>
    <mat-select [value]="statusFiltro()" (selectionChange)="statusFiltro.set($event.value)">
      <mat-option *ngFor="let status of statusDisponiveis()" [value]="status">{{ status }}</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline" class="filter-field">
    <mat-label>Cliente</mat-label>
    <input matInput type="text" placeholder="Nome ou id" [value]="clienteFiltro()" (input)="clienteFiltro.set($any($event.target).value)" />
  </mat-form-field>

  <mat-form-field appearance="outline" class="filter-field">
    <mat-label>Produto</mat-label>
    <input matInput type="text" placeholder="Nome do item" [value]="produtoFiltro()" (input)="produtoFiltro.set($any($event.target).value)" />
  </mat-form-field>
</section>

<div class="feedback" *ngIf="pedidoFeedback()">{{ pedidoFeedback() }}</div>
<div class="loading" *ngIf="loadingPedidos()">
  <mat-spinner diameter="32"></mat-spinner>
  <span>Carregando pedidos...</span>
</div>
<p class="muted" *ngIf="!loadingPedidos() && !pedidosFiltrados().length">Nenhum pedido encontrado para este filtro.</p>

<div class="order-grid" *ngIf="!loadingPedidos() && pedidosFiltrados().length">
  <mat-card class="order-card" *ngFor="let pedido of pedidosFiltrados()">
    <mat-card-header>
      <div mat-card-avatar class="avatar"><mat-icon>shopping_bag</mat-icon></div>
      <div class="header-text">
        <mat-card-title>Pedido #{{ pedido.id?.slice(-6) }}</mat-card-title>
        <mat-card-subtitle>Cliente: {{ nomeDoCliente(pedido.usuarioId) }}</mat-card-subtitle>
      </div>
      <mat-chip-set aria-label="status do pedido" class="status-chip">
        <mat-chip
          appearance="outlined"
          [ngClass]="statusClass(pedido.status)"
          [disableRipple]="true"
          >{{ pedido.status ?? 'SEM STATUS' }}</mat-chip
        >
      </mat-chip-set>
    </mat-card-header>

    <mat-card-content>
      <div class="items-title">Itens</div>
      <ul>
        <li *ngFor="let item of pedido.itens">
          <mat-icon fontIcon="radio_button_unchecked"></mat-icon>
          <div class="item-body">
            <span class="item-name">{{ nomeDoProduto(item.produtoId) }}</span>
            <span class="muted">Qtd: {{ item.quantidade }}</span>
          </div>
        </li>
      </ul>
    </mat-card-content>
  </mat-card>
</div>
